# TransactionService

## Описание

`TransactionService` — это сервис, предоставляющий функциональность для обработки транзакций, сохранения информации о транзакциях, а также проверки лимитов по счетам. Он использует данные о транзакциях, лимитах и обменных курсах валют для выполнения различных операций, связанных с транзакциями пользователей.

Основная задача класса — сохранить транзакцию и проверить, не превышает ли сумма лимит для указанной категории расходов. Если лимит превышен, транзакция помечается как превышающая лимит.

## Функциональность

1. **Сохранение транзакции**:
   Метод `save(TransactionDTO transactionDTO)` сохраняет транзакцию в репозитории и проверяет, превышает ли сумма транзакции установленный лимит для данной категории расходов. Если лимит отсутствует, создается новый лимит.

2. **Получение транзакций, превышающих лимит**:
   Метод `getTransactionsOverTheLimit(String accountNumber)` позволяет получить список всех транзакций для заданного аккаунта, сумма которых превышает установленный лимит.

3. **Конвертация валют**:
   Для транзакций, сумма которых указана в валюте, отличной от доллара США (USD), класс выполняет конвертацию в USD с использованием сервиса обменных курсов (`ExchangeRateService`) для установки флага по превышению лимита.

4. **Работа с лимитами**:
   При сохранении транзакции проверяется, существует ли лимит для категории расхода. Если лимит не существует, он создается с установленной суммой по умолчанию (1000.00).

# LimitService

## Описание

`LimitService` — это сервисный класс, отвечающий за управление лимитами расходов по аккаунтам. Он позволяет создавать лимиты, обновлять существующие и получать лимиты для определенного аккаунта.  

Сервис автоматически конвертирует валюту лимита в доллары США (USD) при необходимости, используя `ExchangeRateService`.  

## Функциональность  

1. **Создание лимита**  
   Метод `createLimit(LimitDTO limitDTO)` создает новый лимит для указанного аккаунта и категории.  
   - Если лимит уже существует, он обновляется.  
   - Если сумма лимита не указана, она устанавливается в `1000.00 USD`.  
   - Если лимит указан в другой валюте, он конвертируется в USD.  

2. **Получение лимитов по номеру счета**  
   Метод `getLimitsByAccountNumber(String accountNumber)` возвращает карту (Map) с лимитами для аккаунта.  
   - Поддерживаются категории `"service"` и `"product"`.  
   - Возвращаются последние установленные лимиты для этих категорий.  

# ExchangeRateService

## Описание  

`ExchangeRateService` — это сервис для управления валютными курсами.  
Он позволяет:  
- Обновлять курсы валют, получая их из внешнего API.  
- Получать актуальный курс валюты.  
- Конвертировать сумму из указанной валюты в USD.  

## Функциональность  

1. **Обновление курсов валют**  
   - Метод `updateExchangeRates()` обновляет курсы KZT и RUB.  
   - Если API недоступно, берётся последний сохранённый курс.  

2. **Получение актуального курса**  
   - Метод `getExchangeRate(String currency)` возвращает последний доступный курс валюты.  
   - Если курс отсутствует, логируется предупреждение.  

3. **Конвертация валюты в USD**  
   - Метод `convertCurrentCurrencyInUsd(BigDecimal sum, String currency)` конвертирует сумму в USD, используя актуальный курс.  
   - Если курс недоступен или некорректен, выбрасывается исключение.  

## Используемые технологии  

- **Spring Boot** — для управления зависимостями и внедрения зависимостей.  
- **Spring Data JPA** — для работы с базой данных.  
- **SLF4J + LoggerFactory** — для логирования событий.  
- **RestTemplate** — для HTTP-запросов к API курсов валют.